<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <style>
        body {
            background-color: lightgrey;
        }

        canvas {
            border: gray solid 1px;
            image-rendering: pixelated;
            min-width: 200px;
            margin: 2px
        }

        canvas.palette {
            min-width: 400px;
        }

        .images {
            display: grid;
            grid-template-columns: repeat(2, min-content);
        }
    </style>
</head>

<body>
    <div class="global_palette">
        <div>global_color_table</div>
        <canvas class="palette" id="global_color_table" width="16" height="16"></canvas>
    </div>
    <div class="images">
        <div>local_color_table</div>
        <div>image</div>
    </div>


    <script src="gif_data.js"></script>
    <script>
        let canvas_global_palette = document.getElementById("global_color_table");
        let div_images = document.getElementsByClassName("images")[0];

        if (global_color_table_flag) {
            let ctx = canvas_global_palette.getContext("2d");
            let buf = ctx.getImageData(0, 0, canvas_global_palette.width, canvas_global_palette.height);
            buf.data.fill(200);
            for (let i = 0; global_color_table.length / 3 > i; i++) {
                buf.data[i * 4 + 0] = global_color_table[i * 3 + 0];
                buf.data[i * 4 + 1] = global_color_table[i * 3 + 1];
                buf.data[i * 4 + 2] = global_color_table[i * 3 + 2];
                buf.data[i * 4 + 3] = 255;
            }
            ctx.putImageData(buf, 0, 0);
        }

        for (let current_frame = 0; frames > current_frame; current_frame++) {
            let canvas_local_palette = document.createElement("canvas");
            canvas_local_palette.className = "palette";
            canvas_local_palette.width = 16;
            canvas_local_palette.height = 16;

            if (local_color_tables[current_frame] !== -1) {
                let ctx = canvas_local_palette.getContext("2d");
                let buf = ctx.getImageData(0, 0, canvas_local_palette.width, canvas_local_palette.height);
                buf.data.fill(200);
                for (let i = 0; local_color_tables[current_frame].length / 3 > i; i++) {
                    buf.data[i * 4 + 0] = local_color_tables[current_frame][i * 3 + 0];
                    buf.data[i * 4 + 1] = local_color_tables[current_frame][i * 3 + 1];
                    buf.data[i * 4 + 2] = local_color_tables[current_frame][i * 3 + 2];
                    buf.data[i * 4 + 3] = 255;
                }
                ctx.putImageData(buf, 0, 0);
            }

            div_images.appendChild(canvas_local_palette);


            let image = document.createElement("canvas");
            image.className = current_frame;
            image.width = logical_screen_width;
            image.height = logical_screen_height;

            ctx = image.getContext("2d");
            buf = ctx.getImageData(image_pos[current_frame][0], image_pos[current_frame][1],
                image_size[current_frame][0], image_size[current_frame][1]);
            for (let i = 0; index_streams[current_frame].length > i; i++) {
                if (transparent_color_indexs[current_frame] === index_streams[current_frame][i]) {
                    continue
                }
                buf.data[i * 4 + 0] = global_color_table[index_streams[current_frame][i] * 3 + 0];
                buf.data[i * 4 + 1] = global_color_table[index_streams[current_frame][i] * 3 + 1];
                buf.data[i * 4 + 2] = global_color_table[index_streams[current_frame][i] * 3 + 2];
                buf.data[i * 4 + 3] = 255;
            }


            ctx.putImageData(buf, image_pos[current_frame][0], image_pos[current_frame][1]);

            div_images.appendChild(image);
        }
    </script>
</body>

</html>